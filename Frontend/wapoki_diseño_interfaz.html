<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veterinaria Wapoki</title>
    <link rel="stylesheet" href="estilos.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const API_URL = 'http://localhost:3001/api';

        // --- MODAL PARA MASCOTAS ---
        const PetModal = ({ pet, clients, onClose, onSave }) => {
            const [formData, setFormData] = useState({ nombre: pet?.nombre || '', especie: pet?.especie || 'Perro', raza: pet?.raza || '', edad: pet?.edad || '', peso: pet?.peso || '', id_cliente: pet?.id_cliente || (clients.length > 0 ? clients[0].id_cliente : '') });
            useEffect(() => { if (!formData.id_cliente && clients.length > 0) setFormData(prev => ({ ...prev, id_cliente: clients[0].id_cliente })); }, [clients, formData.id_cliente]);
            const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
            const handleSubmit = (e) => { e.preventDefault(); const dataToSave = pet?.id_mascota ? { ...formData, id_mascota: pet.id_mascota } : formData; onSave(dataToSave); };
            return (<div className="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4"><div className="bg-white rounded-lg shadow-2xl p-8 w-full max-w-lg fade-in"><h2 className="text-2xl font-bold text-gray-800 mb-6">{pet ? 'Editar Mascota' : 'Añadir Nueva Mascota'}</h2><form onSubmit={handleSubmit}><div className="grid grid-cols-1 md:grid-cols-2 gap-4"><input type="text" name="nombre" value={formData.nombre} onChange={handleChange} placeholder="Nombre de la mascota" className="p-3 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" required /><select name="especie" value={formData.especie} onChange={handleChange} className="p-3 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none bg-white"><option>Perro</option><option>Gato</option><option>Ave</option><option>Reptil</option><option>Otro</option></select><input type="text" name="raza" value={formData.raza} onChange={handleChange} placeholder="Raza" className="p-3 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" required /><input type="number" name="edad" value={formData.edad} onChange={handleChange} placeholder="Edad" className="p-3 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" required /><input type="number" step="0.01" name="peso" value={formData.peso} onChange={handleChange} placeholder="Peso (kg)" className="p-3 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" required /><select name="id_cliente" value={formData.id_cliente} onChange={handleChange} className="p-3 border rounded-lg md:col-span-2 focus:ring-2 focus:ring-orange-400 focus:outline-none bg-white" required><option value="" disabled>-- Seleccione un Dueño --</option>{clients.map(client => (<option key={client.id_cliente} value={client.id_cliente}>{client.nombre} {client.apellido}</option>))}</select></div><div className="flex justify-end space-x-4 mt-8"><button type="button" onClick={onClose} className="py-2 px-6 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">Cancelar</button><button type="submit" className="py-2 px-6 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">Guardar</button></div></form></div></div>);
        };

        // --- MODAL PARA CLIENTES ---
        const ClientModal = ({ client, onClose, onSave }) => {
            const [formData, setFormData] = useState(client || { nombre: '', apellido: '', telefono: '', email: '', direccion: '' });
            const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
            const handleSubmit = (e) => { e.preventDefault(); const dataToSave = client?.id_cliente ? { ...formData, id_cliente: client.id_cliente } : formData; onSave(dataToSave); };
            return (<div className="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4"><div className="bg-white rounded-lg shadow-2xl p-8 w-full max-w-lg fade-in"><h2 className="text-2xl font-bold text-gray-800 mb-6">{client ? 'Editar Cliente' : 'Añadir Nuevo Cliente'}</h2><form onSubmit={handleSubmit}><div className="grid grid-cols-1 md:grid-cols-2 gap-4"><input type="text" name="nombre" value={formData.nombre} onChange={handleChange} placeholder="Nombre" className="p-3 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" required /><input type="text" name="apellido" value={formData.apellido} onChange={handleChange} placeholder="Apellido" className="p-3 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" required /><input type="tel" name="telefono" value={formData.telefono} onChange={handleChange} placeholder="Teléfono" className="p-3 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" /><input type="email" name="email" value={formData.email} onChange={handleChange} placeholder="Email" className="p-3 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" /><input type="text" name="direccion" value={formData.direccion} onChange={handleChange} placeholder="Dirección" className="p-3 border rounded-lg md:col-span-2 focus:ring-2 focus:ring-orange-400 focus:outline-none" /></div><div className="flex justify-end space-x-4 mt-8"><button type="button" onClick={onClose} className="py-2 px-6 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">Cancelar</button><button type="submit" className="py-2 px-6 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">Guardar</button></div></form></div></div>);
        };

        // --- MODAL PARA CITAS ---
        const AppointmentModal = ({ appointment, pets, vets, onClose, onSave }) => {
            const [formData, setFormData] = useState({
                fecha: appointment?.fecha ? new Date(appointment.fecha).toISOString().split('T')[0] : '',
                hora: appointment?.hora || '',
                id_mascota: appointment?.id_mascota || (pets.length > 0 ? pets[0].id_mascota : ''),
                id_veterinario: appointment?.id_veterinario || (vets.length > 0 ? vets[0].id_veterinario : ''),
                motivo: appointment?.motivo || ''
            });
            const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
            const handleSubmit = (e) => { e.preventDefault(); const dataToSave = appointment?.id_cita ? { ...formData, id_cita: appointment.id_cita } : formData; onSave(dataToSave); };
            return (<div className="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4"><div className="bg-white rounded-lg shadow-2xl p-8 w-full max-w-lg fade-in"><h2 className="text-2xl font-bold text-gray-800 mb-6">{appointment ? 'Editar Cita' : 'Agendar Nueva Cita'}</h2><form onSubmit={handleSubmit}><div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="date" name="fecha" value={formData.fecha} onChange={handleChange} className="p-3 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" required />
                <input type="time" name="hora" value={formData.hora} onChange={handleChange} className="p-3 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" required />
                <select name="id_mascota" value={formData.id_mascota} onChange={handleChange} className="p-3 border rounded-lg md:col-span-2 focus:ring-2 focus:ring-orange-400 focus:outline-none bg-white" required><option value="" disabled>-- Seleccione una Mascota --</option>{pets.map(pet => (<option key={pet.id_mascota} value={pet.id_mascota}>{pet.nombre} ({pet.nombre_cliente})</option>))}</select>
                <select name="id_veterinario" value={formData.id_veterinario} onChange={handleChange} className="p-3 border rounded-lg md:col-span-2 focus:ring-2 focus:ring-orange-400 focus:outline-none bg-white" required><option value="" disabled>-- Seleccione un Veterinario --</option>{vets.map(vet => (<option key={vet.id_veterinario} value={vet.id_veterinario}>{vet.nombre} {vet.apellido}</option>))}</select>
                <textarea name="motivo" value={formData.motivo} onChange={handleChange} placeholder="Motivo de la consulta" className="p-3 border rounded-lg md:col-span-2 focus:ring-2 focus:ring-orange-400 focus:outline-none" rows="3" required></textarea>
            </div><div className="flex justify-end space-x-4 mt-8"><button type="button" onClick={onClose} className="py-2 px-6 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">Cancelar</button><button type="submit" className="py-2 px-6 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">Guardar</button></div></form></div></div>);
        };

        // --- PÁGINA DE GESTIÓN DE MASCOTAS ---
        const PetsPage = ({ data, onSave, onDelete }) => {
            const { pets, clients } = data;
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingPet, setEditingPet] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const filteredPets = pets.filter(pet => Object.values(pet).some(value => String(value).toLowerCase().includes(searchTerm.toLowerCase())));
            return (<div>{isModalOpen && <PetModal pet={editingPet} clients={clients} onClose={() => { setIsModalOpen(false); setEditingPet(null); }} onSave={onSave} />}<header className="mb-8"><h1 className="text-3xl font-bold text-gray-800">Panel de Gestión de Mascotas</h1></header><div className="bg-white p-6 rounded-lg shadow-md"><div className="flex flex-col md:flex-row justify-between items-center mb-6 gap-4"><div className="relative w-full md:w-1/3"><i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i><input type="text" placeholder="Buscar mascota, dueño..." className="w-full p-3 pl-10 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} /></div><button onClick={() => { setEditingPet(null); setIsModalOpen(true); }} className="w-full md:w-auto bg-orange-500 text-white font-semibold py-3 px-6 rounded-lg hover:bg-orange-600 transition-colors flex items-center justify-center space-x-2"><i className="fas fa-plus"></i><span>Añadir Mascota</span></button></div><div className="overflow-x-auto"><table className="w-full text-left"><thead className="bg-gray-50 border-b"><tr><th className="p-4 font-semibold text-gray-600">Mascota</th><th className="p-4 font-semibold text-gray-600">Especie</th><th className="p-4 font-semibold text-gray-600">Dueño</th><th className="p-4 font-semibold text-gray-600 text-center">Peso (kg)</th><th className="p-4 font-semibold text-gray-600 text-center">Acciones</th></tr></thead><tbody>{filteredPets.map(pet => (<tr key={pet.id_mascota} className="border-b hover:bg-gray-50"><td className="p-4"><div className="font-semibold text-gray-800">{pet.nombre}</div><div className="text-sm text-gray-500">{pet.raza} - {pet.edad} años</div></td><td className="p-4 text-gray-700">{pet.especie}</td><td className="p-4 text-gray-700">{pet.nombre_cliente}</td><td className="p-4 text-gray-700 text-center">{pet.peso}</td><td className="p-4 text-center"><button onClick={() => { setEditingPet(pet); setIsModalOpen(true); }} className="text-blue-500 hover:text-blue-700 p-2" title="Editar"><i className="fas fa-edit fa-lg"></i></button><button onClick={() => onDelete(pet.id_mascota)} className="text-red-500 hover:text-red-700 p-2" title="Eliminar"><i className="fas fa-trash-alt fa-lg"></i></button></td></tr>))}</tbody></table></div>{filteredPets.length === 0 && (<div className="text-center py-10 text-gray-500"><i className="fas fa-paw fa-3x mb-4"></i><p className="font-semibold">No se encontraron mascotas</p></div>)}</div></div>);
        };

        // --- PÁGINA DE GESTIÓN DE CLIENTES ---
        const ClientsPage = ({ data, onSave, onDelete }) => {
            const { clients } = data;
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingClient, setEditingClient] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const filteredClients = clients.filter(client => Object.values(client).some(value => String(value).toLowerCase().includes(searchTerm.toLowerCase())));
            return (<div>{isModalOpen && <ClientModal client={editingClient} onClose={() => { setIsModalOpen(false); setEditingClient(null); }} onSave={onSave} />}<header className="mb-8"><h1 className="text-3xl font-bold text-gray-800">Panel de Gestión de Clientes</h1></header><div className="bg-white p-6 rounded-lg shadow-md"><div className="flex flex-col md:flex-row justify-between items-center mb-6 gap-4"><div className="relative w-full md:w-1/3"><i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i><input type="text" placeholder="Buscar por nombre, email, teléfono..." className="w-full p-3 pl-10 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} /></div><button onClick={() => { setEditingClient(null); setIsModalOpen(true); }} className="w-full md:w-auto bg-orange-500 text-white font-semibold py-3 px-6 rounded-lg hover:bg-orange-600 transition-colors flex items-center justify-center space-x-2"><i className="fas fa-plus"></i><span>Añadir Cliente</span></button></div><div className="overflow-x-auto"><table className="w-full text-left"><thead className="bg-gray-50 border-b"><tr><th className="p-4 font-semibold text-gray-600">Nombre</th><th className="p-4 font-semibold text-gray-600">Contacto</th><th className="p-4 font-semibold text-gray-600">Dirección</th><th className="p-4 font-semibold text-gray-600 text-center">Acciones</th></tr></thead><tbody>{filteredClients.map(client => (<tr key={client.id_cliente} className="border-b hover:bg-gray-50"><td className="p-4"><div className="font-semibold text-gray-800">{client.nombre} {client.apellido}</div></td><td className="p-4"><div className="text-sm text-gray-700">{client.email}</div><div className="text-sm text-gray-500">{client.telefono}</div></td><td className="p-4 text-gray-700">{client.direccion}</td><td className="p-4 text-center"><button onClick={() => { setEditingClient(client); setIsModalOpen(true); }} className="text-blue-500 hover:text-blue-700 p-2" title="Editar"><i className="fas fa-edit fa-lg"></i></button><button onClick={() => onDelete(client.id_cliente)} className="text-red-500 hover:text-red-700 p-2" title="Eliminar"><i className="fas fa-trash-alt fa-lg"></i></button></td></tr>))}</tbody></table></div>{filteredClients.length === 0 && (<div className="text-center py-10 text-gray-500"><i className="fas fa-users fa-3x mb-4"></i><p className="font-semibold">No se encontraron clientes</p></div>)}</div></div>);
        };
        
        // --- PÁGINA DE GESTIÓN DE CITAS ---
        const AppointmentsPage = ({ data, onSave, onDelete }) => {
            const { appointments, pets, vets } = data;
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingAppointment, setEditingAppointment] = useState(null);
            return (<div>{isModalOpen && <AppointmentModal appointment={editingAppointment} pets={pets} vets={vets} onClose={() => { setIsModalOpen(false); setEditingAppointment(null); }} onSave={onSave} />}<header className="mb-8"><h1 className="text-3xl font-bold text-gray-800">Panel de Gestión de Citas</h1></header><div className="bg-white p-6 rounded-lg shadow-md"><div className="flex justify-end mb-6"><button onClick={() => { setEditingAppointment(null); setIsModalOpen(true); }} className="bg-orange-500 text-white font-semibold py-3 px-6 rounded-lg hover:bg-orange-600 transition-colors flex items-center justify-center space-x-2"><i className="fas fa-plus"></i><span>Agendar Cita</span></button></div><div className="overflow-x-auto"><table className="w-full text-left"><thead className="bg-gray-50 border-b"><tr><th className="p-4 font-semibold text-gray-600">Fecha y Hora</th><th className="p-4 font-semibold text-gray-600">Paciente</th><th className="p-4 font-semibold text-gray-600">Veterinario</th><th className="p-4 font-semibold text-gray-600">Motivo</th><th className="p-4 font-semibold text-gray-600 text-center">Acciones</th></tr></thead><tbody>{appointments.map(appt => (<tr key={appt.id_cita} className="border-b hover:bg-gray-50"><td className="p-4"><div className="font-semibold text-gray-800">{new Date(appt.fecha).toLocaleDateString()}</div><div className="text-sm text-gray-500">{appt.hora}</div></td><td className="p-4"><div className="font-semibold text-gray-800">{appt.nombre_mascota}</div><div className="text-sm text-gray-500">{appt.nombre_cliente}</div></td><td className="p-4 text-gray-700">{appt.nombre_veterinario}</td><td className="p-4 text-gray-700">{appt.motivo}</td><td className="p-4 text-center"><button onClick={() => { setEditingAppointment(appt); setIsModalOpen(true); }} className="text-blue-500 hover:text-blue-700 p-2" title="Editar"><i className="fas fa-edit fa-lg"></i></button><button onClick={() => onDelete(appt.id_cita)} className="text-red-500 hover:text-red-700 p-2" title="Eliminar"><i className="fas fa-trash-alt fa-lg"></i></button></td></tr>))}</tbody></table></div>{appointments.length === 0 && (<div className="text-center py-10 text-gray-500"><i className="fas fa-calendar-check fa-3x mb-4"></i><p className="font-semibold">No hay citas programadas</p></div>)}</div></div>);
        };

        // --- PÁGINA DE FACTURACIÓN ---
        const BillingPage = ({ data }) => {
            const { bills } = data;
            const getPaymentMethodStyle = (method) => {
                const styles = { Efectivo: 'bg-green-100 text-green-800', Tarjeta: 'bg-indigo-100 text-indigo-800', Transferencia: 'bg-sky-100 text-sky-800' };
                return styles[method] || 'bg-gray-100 text-gray-800';
            };
            return (<div><header className="mb-8"><h1 className="text-3xl font-bold text-gray-800">Historial de Facturación</h1></header><div className="bg-white p-6 rounded-lg shadow-md"><div className="overflow-x-auto"><table className="w-full text-left"><thead className="bg-gray-50 border-b"><tr><th className="p-4 font-semibold text-gray-600">Factura #</th><th className="p-4 font-semibold text-gray-600">Cliente</th><th className="p-4 font-semibold text-gray-600">Fecha</th><th className="p-4 font-semibold text-gray-600 text-center">Método de Pago</th><th className="p-4 font-semibold text-gray-600 text-right">Total</th></tr></thead><tbody>{bills.map(bill => (<tr key={bill.id_factura} className="border-b hover:bg-gray-50"><td className="p-4 font-mono text-gray-600">{String(bill.id_factura).padStart(5, '0')}</td><td className="p-4 font-semibold text-gray-800">{bill.nombre_cliente}</td><td className="p-4 text-gray-700">{new Date(bill.fecha_emision).toLocaleDateString()}</td><td className="p-4 text-center"><span className={`px-3 py-1 text-sm font-medium rounded-full ${getPaymentMethodStyle(bill.metodo_pago)}`}>{bill.metodo_pago}</span></td><td className="p-4 text-right font-semibold text-gray-800">${new Intl.NumberFormat('es-CO').format(bill.total)}</td></tr>))}</tbody></table></div>{bills.length === 0 && (<div className="text-center py-10 text-gray-500"><i className="fas fa-file-invoice-dollar fa-3x mb-4"></i><p className="font-semibold">No hay facturas emitidas</p></div>)}</div></div>);
        };
        
        // --- CONTENEDOR PRINCIPAL DEL DASHBOARD ---
        const DashboardPage = ({ user, onLogout }) => {
            const [activeView, setActiveView] = useState('pets');
            const [data, setData] = useState({ pets: [], clients: [], appointments: [], vets: [], bills: [] });
            const [loading, setLoading] = useState(true);

            const fetchAllData = useCallback(async () => {
                setLoading(true);
                try {
                    const responses = await Promise.all([ fetch(`${API_URL}/mascotas`), fetch(`${API_URL}/clientes`), fetch(`${API_URL}/citas`), fetch(`${API_URL}/veterinarios`), fetch(`${API_URL}/facturacion`) ]);
                    for (const res of responses) { if (!res.ok) throw new Error('Error al cargar los datos.'); }
                    const [pets, clients, appointments, vets, bills] = await Promise.all(responses.map(res => res.json()));
                    setData({ pets, clients, appointments, vets, bills });
                } catch (error) { console.error("Error fetching data:", error); alert('No se pudieron cargar los datos.'); } 
                finally { setLoading(false); }
            }, []);

            useEffect(() => { fetchAllData(); }, [fetchAllData]);

            const handleSave = async (endpoint, itemData) => {
                const isEditing = !!itemData[`id_${endpoint.slice(0, -1)}`];
                const url = isEditing ? `${API_URL}/${endpoint}/${itemData[`id_${endpoint.slice(0, -1)}`]}` : `${API_URL}/${endpoint}`;
                const method = isEditing ? 'PUT' : 'POST';
                try {
                    const response = await fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(itemData) });
                    if (!response.ok) { const err = await response.json(); throw new Error(err.error || 'Error al guardar.'); }
                    await fetchAllData();
                } catch (error) { console.error(`Error saving ${endpoint}:`, error); alert(error.message); }
            };

            const handleDelete = async (endpoint, itemId) => {
                if (window.confirm(`¿Estás seguro de que quieres eliminar este elemento?`)) {
                    try {
                        const response = await fetch(`${API_URL}/${endpoint}/${itemId}`, { method: 'DELETE' });
                        if (!response.ok) { const err = await response.json(); throw new Error(err.error || 'Error al eliminar.'); }
                        await fetchAllData();
                    } catch (error) { console.error(`Error deleting ${endpoint}:`, error); alert(error.message); }
                }
            };

            const renderActiveView = () => {
                if (loading) return <div className="text-center py-20"><i className="fas fa-spinner fa-spin fa-3x text-orange-500"></i></div>;
                switch (activeView) {
                    case 'pets': return <PetsPage data={data} onSave={(item) => handleSave('mascotas', item)} onDelete={(id) => handleDelete('mascotas', id)} />;
                    case 'clients': return <ClientsPage data={data} onSave={(item) => handleSave('clientes', item)} onDelete={(id) => handleDelete('clientes', id)} />;
                    case 'appointments': return <AppointmentsPage data={data} onSave={(item) => handleSave('citas', item)} onDelete={(id) => handleDelete('citas', id)} />;
                    case 'billing': return <BillingPage data={data} />;
                    default: return <PetsPage data={data} />;
                }
            };
            
            const NavLink = ({ view, icon, children }) => (
                <a href="#" onClick={(e) => { e.preventDefault(); setActiveView(view); }} className={`flex items-center p-3 rounded-lg transition-colors ${activeView === view ? 'bg-orange-100 text-gray-900 font-semibold' : 'text-gray-600 hover:bg-gray-100'}`}>
                    <i className={`fas ${icon} w-6 ${activeView === view ? 'text-orange-500' : ''}`}></i><span>{children}</span>
                </a>
            );

            return (<div className="min-h-screen bg-slate-50 flex">
                <aside className="w-64 bg-white shadow-md flex flex-col flex-shrink-0"><div className="p-6 flex items-center space-x-3 border-b"><img src="Imagenes/logo_fondo_claro.png" alt="Logo Wapoki" className="h-10 w-10 rounded-full" /><span className="text-2xl font-bold text-orange-500">Wapoki</span></div><nav className="flex-1 p-4 space-y-2">
                    <NavLink view="pets" icon="fa-paw">Mascotas</NavLink>
                    <NavLink view="clients" icon="fa-users">Clientes</NavLink>
                    <NavLink view="appointments" icon="fa-calendar-alt">Citas</NavLink>
                    <NavLink view="billing" icon="fa-file-invoice">Facturación</NavLink>
                </nav><div className="p-4 border-t"><button onClick={onLogout} className="w-full flex items-center p-3 text-gray-600 hover:bg-red-50 hover:text-red-600 rounded-lg"><i className="fas fa-sign-out-alt w-6"></i><span>Cerrar Sesión</span></button></div></aside>
                <main className="flex-1 p-8 overflow-y-auto">{renderActiveView()}</main>
            </div>);
        };
        
        // --- COMPONENTE DE LANDING PAGE RESTAURADO ---
        const LandingPage = ({ onNavigate }) => {
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const handleScrollTo = (e, selector) => {
                e.preventDefault();
                const element = document.querySelector(selector);
                if (element) { element.scrollIntoView({ behavior: 'smooth' }); }
                setIsMenuOpen(false);
            };
            return (<div>
                <header className="bg-white shadow-md sticky top-0 z-50">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
                        <a href="#" onClick={(e) => handleScrollTo(e, 'body')} className="flex items-center space-x-3 min-w-0">
                            <img src="Imagenes/logo_fondo_claro.png" alt="Logo Wapoki" className="h-10 w-10 rounded-full" />
                            <span className="text-3xl font-bold text-orange-500 truncate">Wapoki</span>
                        </a>
                        <nav className="hidden md:flex space-x-6 items-center">
                            <a href="#quienes-somos" onClick={(e) => handleScrollTo(e, '#quienes-somos')} className="text-gray-600 hover:text-orange-500">¿Quiénes somos?</a>
                            <a href="#objetivos" onClick={(e) => handleScrollTo(e, '#objetivos')} className="text-gray-600 hover:text-orange-500">Objetivos</a>
                            <a href="#servicios" onClick={(e) => handleScrollTo(e, '#servicios')} className="text-gray-600 hover:text-orange-500">Servicios</a>
                            <a href="#contacto-footer" onClick={(e) => handleScrollTo(e, '#contacto-footer')} className="text-gray-600 hover:text-orange-500">Contacto</a>
                        </nav>
                        <div className="hidden md:flex space-x-3 items-center">
                            <button onClick={() => onNavigate('login')} className="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-lg">Iniciar sesión</button>
                            <button onClick={() => onNavigate('register')} className="border border-orange-500 text-orange-500 hover:bg-orange-500 hover:text-white font-semibold py-2 px-4 rounded-lg">Registrarse</button>
                        </div>
                        <div className="md:hidden"><button onClick={() => setIsMenuOpen(!isMenuOpen)} className="text-gray-600 hover:text-orange-500"><i className="fas fa-bars fa-lg"></i></button></div>
                    </div>
                    {isMenuOpen && (<div className="md:hidden bg-white shadow-lg"><a href="#quienes-somos" onClick={(e) => handleScrollTo(e, '#quienes-somos')} className="block px-6 py-3 text-gray-600 hover:bg-orange-50">¿Quiénes somos?</a><a href="#objetivos" onClick={(e) => handleScrollTo(e, '#objetivos')} className="block px-6 py-3 text-gray-600 hover:bg-orange-50">Objetivos</a><a href="#servicios" onClick={(e) => handleScrollTo(e, '#servicios')} className="block px-6 py-3 text-gray-600 hover:bg-orange-50">Servicios</a><a href="#contacto-footer" onClick={(e) => handleScrollTo(e, '#contacto-footer')} className="block px-6 py-3 text-gray-600 hover:bg-orange-50">Contacto</a><div className="px-6 py-3 border-t"><button onClick={() => onNavigate('login')} className="block w-full text-center bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-lg mb-2">Iniciar sesión</button><button onClick={() => onNavigate('register')} className="block w-full text-center border border-orange-500 text-orange-500 hover:bg-orange-500 hover:text-white font-semibold py-2 px-4 rounded-lg">Registrarse</button></div></div>)}
                </header>
                <main>
                    <section className="hero-section-diagonal"><div className="hero-image-strip-diagonal" style={{backgroundImage: "url('Imagenes/perro.jpg')"}}></div><div className="hero-image-strip-diagonal" style={{backgroundImage: "url('Imagenes/gato.jpg')"}}></div><div className="hero-image-strip-diagonal" style={{backgroundImage: "url('Imagenes/hamster.jpg')"}}></div><div className="hero-image-strip-diagonal" style={{backgroundImage: "url('Imagenes/conejo.jpg')"}}></div><div className="hero-image-strip-diagonal" style={{backgroundImage: "url('Imagenes/perro_2.jpg')"}}></div></section>
                    <section id="quienes-somos" className="py-16 bg-white"><div className="container mx-auto px-6 text-center"><h1 className="text-4xl font-bold text-gray-800 mb-6">Bienvenido a <span className="gradient-text">Wapoki</span></h1><p className="text-lg text-gray-600 mb-8 max-w-3xl mx-auto">En Wapoki, amamos a los animales tanto como tú. Somos un equipo de profesionales dedicados al cuidado de tus mascotas, ofreciendo servicios veterinarios en un ambiente cálido y amigable.</p><div className="grid md:grid-cols-2 gap-8 items-center"><div className="text-left"><h2 className="text-2xl font-semibold text-orange-500 mb-4">Nuestra Misión</h2><p className="text-gray-600 mb-4">Proporcionar atención veterinaria excepcional y compasiva, promoviendo la salud y el bienestar de las mascotas y fortaleciendo el vínculo especial que comparten con sus familias. Buscamos ser un referente en Bogotá, conectando veterinarios y facilitando el acceso a historiales clínicos.</p><h2 className="text-2xl font-semibold text-orange-500 mb-4">Nuestra Visión</h2><p className="text-gray-600">Ser la clínica veterinaria líder en innovación y cuidado animal, reconocida por nuestra excelencia profesional, trato ético y compromiso con la comunidad y sus mascotas.</p></div><div><img src="Imagenes/equipo.jpg" alt="Equipo veterinario Wapoki" className="rounded-lg shadow-xl mx-auto w-64 h-64 object-cover" /></div></div></div></section>
                    <section id="objetivos" className="py-16 bg-orange-50"><div className="container mx-auto px-6"><h2 className="text-3xl font-bold text-center text-orange-600 mb-10">Nuestros Objetivos</h2><div className="grid md:grid-cols-3 gap-8 text-center"><div className="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><div className="text-orange-500 mb-4"><i className="fas fa-heartbeat fa-3x"></i></div><h3 className="text-xl font-semibold text-gray-700 mb-2">Bienestar Animal</h3><p className="text-gray-600">Garantizar la salud y felicidad de cada mascota que nos visita a través de medicina preventiva y tratamientos efectivos.</p></div><div className="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><div className="text-orange-500 mb-4"><i className="fas fa-users fa-3x"></i></div><h3 className="text-xl font-semibold text-gray-700 mb-2">Confianza del Cliente</h3><p className="text-gray-600">Construir relaciones duraderas con nuestros clientes basadas en la transparencia, comunicación y un servicio excepcional.</p></div><div className="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><div className="text-orange-500 mb-4"><i className="fas fa-notes-medical fa-3x"></i></div><h3 className="text-xl font-semibold text-gray-700 mb-2">Historias Clínicas Digitales</h3><p className="text-gray-600">Implementar y facilitar el acceso a historiales clínicos digitales para una atención coordinada y eficiente.</p></div></div></div></section>
                    <section id="servicios" className="py-16 bg-white"><div className="container mx-auto px-6"><h2 className="text-3xl font-bold text-center text-gray-800 mb-10">Nuestros Servicios</h2><div className="grid sm:grid-cols-2 lg:grid-cols-4 gap-8">{[{ icon: 'fa-stethoscope', title: 'Consultas Generales', desc: 'Atención médica completa para el diagnóstico y tratamiento.' }, { icon: 'fa-syringe', title: 'Vacunación', desc: 'Planes de vacunación personalizados para proteger a tu mascota.' }, { icon: 'fa-cut', title: 'Cirugías', desc: 'Procedimientos quirúrgicos con equipos modernos y cualificados.' }, { icon: 'fa-dog', title: 'Peluquería y Spa', desc: 'Servicios para que tu mascota luzca y se sienta genial.' }].map(service => (<div key={service.title} className="bg-gray-50 p-6 rounded-lg shadow-md text-center hover:shadow-lg transition-shadow duration-300"><div className="text-orange-500 mb-4"><i className={`fas ${service.icon} fa-3x`}></i></div><h3 className="text-xl font-semibold text-gray-700 mb-2">{service.title}</h3><p className="text-gray-600 text-sm">{service.desc}</p></div>))}</div></div></section>
                    <section className="py-16 bg-orange-50"><div className="container mx-auto px-6"><h2 className="text-3xl font-bold text-center text-orange-600 mb-10">Lo que Dicen Nuestros Clientes</h2><div className="grid md:grid-cols-2 gap-8"><div className="bg-white p-8 rounded-lg shadow-lg"><p className="text-gray-600 italic mb-4">"La veterinaria Wapoki atendió a mi perro Buñuelo con mucho cariño y profesionalismo. ¡Estamos muy agradecidos por su excelente atención!"</p><p className="text-gray-800 font-semibold">- Tatiana y Buñuelo</p></div><div className="bg-white p-8 rounded-lg shadow-lg"><p className="text-gray-600 italic mb-4">"Wapoki es mi veterinaria de confianza, mis gatos están más sanos y felices. Sus servicios son de primera y el personal es increíblemente amable."</p><p className="text-gray-800 font-semibold">- Carlos, Michoso y Oreo</p></div></div></div></section>
                    <section className="py-20 bg-orange-500"><div className="container mx-auto px-6 text-center"><h2 className="text-3xl font-bold text-white mb-6">¿Listo para darle a tu mascota el mejor cuidado?</h2><p className="text-orange-100 text-lg mb-8 max-w-2xl mx-auto">Agenda una cita hoy mismo o contáctanos para más información. En Wapoki, tu mascota está en las mejores manos.</p><a href="#contacto-footer" onClick={(e) => handleScrollTo(e, '#contacto-footer')} className="bg-white text-orange-500 font-bold py-3 px-8 rounded-lg hover:bg-orange-100 transition duration-300 text-lg shadow-md">Agendar Cita</a></div></section>
                </main>
                <footer id="contacto-footer" className="bg-gray-700 text-gray-300 py-12">
                    <div className="container mx-auto px-6"><div className="grid md:grid-cols-3 gap-8 items-start"><div className="mb-6 md:mb-0"><a href="#" onClick={(e) => handleScrollTo(e, 'body')} className="flex items-center space-x-3 text-3xl font-bold text-orange-400 mb-4"><img src="Imagenes/logo_fondo_oscuro.png" alt="Logo Wapoki Footer" className="h-10 w-10 rounded-full" /><span>Wapoki</span></a><h4 className="text-xl font-semibold text-white mb-3 mt-2">Sobre Nosotros</h4><p className="text-sm">Buscamos poder conectar todos los veterinarios de Bogotá para empezar a generar historias clínicas para tus mascotas.</p></div><div><h4 className="text-xl font-semibold text-white mb-3">Contactos</h4><ul className="space-y-2 text-sm"><li><i className="fas fa-phone-alt mr-2 text-orange-400"></i><a href="tel:+573143772885" className="hover:text-orange-400">314 377 2885</a></li><li><i className="fas fa-envelope mr-2 text-orange-400"></i><a href="mailto:tatianquina10@gmail.com" className="hover:text-orange-400">tatianquina10@gmail.com</a></li><li><i className="fas fa-map-marker-alt mr-2 text-orange-400"></i>Bogotá, Colombia. Cl. 84 #24 - 78</li></ul></div><div><h4 className="text-xl font-semibold text-white mb-3">Redes Sociales</h4><ul className="space-y-2 text-sm"><li><i className="fab fa-instagram mr-2 text-orange-400"></i><a href="https://www.instagram.com/_tatiana_pulido_/" target="_blank" rel="noopener" className="hover:text-orange-400">@_tatiana_pulido_</a></li><li><i className="fab fa-facebook-f mr-2 text-orange-400"></i><a href="https://www.facebook.com/leiidytatiana07/?locale=es_LA" target="_blank" rel="noopener" className="hover:text-orange-400">/wapokipet</a></li><li><i className="fab fa-whatsapp mr-2 text-orange-400"></i><a href="https://wa.me/573143772885" target="_blank" rel="noopener" className="hover:text-orange-400">WhatsApp (+57 314 377 2885)</a></li></ul></div></div><div className="mt-10 border-t border-gray-600 pt-8 text-center text-sm"><p>&copy; {new Date().getFullYear()} Veterinaria Wapoki. Todos los derechos reservados.</p><p>Diseñado con <i className="fas fa-heart text-orange-400"></i> por el equipo Wapoki.</p></div></div>
                </footer>
            </div>);
        };
        const LoginPage = ({ onLogin, onNavigate }) => { return <div className="min-h-screen flex items-center justify-center bg-orange-50 p-4"><div className="max-w-md w-full bg-white rounded-xl shadow-2xl p-8 lg:p-12 fade-in"><div className="text-center mb-8"><img src="Imagenes/logo_fondo_claro.png" alt="Logo Wapoki" className="h-20 w-20 rounded-full mx-auto mb-4" /><h1 className="text-3xl font-bold text-gray-800">Bienvenido de Nuevo</h1><p className="text-gray-500 mt-2">Inicia sesión para gestionar la clínica.</p></div><form onSubmit={(e) => { e.preventDefault(); onLogin({ name: 'Dr. Pulido' }); }} className="space-y-6"><div><label className="text-sm font-semibold text-gray-600">Email</label><input type="email" className="w-full p-3 mt-1 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" placeholder="tu@email.com" required /></div><div><label className="text-sm font-semibold text-gray-600">Contraseña</label><input type="password" className="w-full p-3 mt-1 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" placeholder="********" required /></div><button type="submit" className="w-full bg-orange-500 text-white font-bold py-3 rounded-lg hover:bg-orange-600 transition-colors text-lg">Iniciar Sesión</button></form><p className="text-center text-sm text-gray-500 mt-8">¿No tienes cuenta? <button onClick={() => onNavigate('register')} className="font-semibold text-orange-500 hover:underline">Regístrate aquí</button></p><p className="text-center text-sm text-gray-500 mt-2"><button onClick={() => onNavigate('landing')} className="hover:underline">Volver al inicio</button></p></div></div>;};
        const RegisterPage = ({ onRegister, onNavigate }) => { return <div className="min-h-screen flex items-center justify-center bg-orange-50 p-4"><div className="max-w-md w-full bg-white rounded-xl shadow-2xl p-8 lg:p-12 fade-in"><div className="text-center mb-8"><img src="Imagenes/logo_fondo_claro.png" alt="Logo Wapoki" className="h-20 w-20 rounded-full mx-auto mb-4" /><h1 className="text-3xl font-bold text-gray-800">Crea tu Cuenta</h1><p className="text-gray-500 mt-2">Únete a la plataforma Wapoki.</p></div><form onSubmit={(e) => { e.preventDefault(); onRegister({ name: 'Nuevo Usuario' }); }} className="space-y-6"><div><label className="text-sm font-semibold text-gray-600">Nombre Completo</label><input type="text" className="w-full p-3 mt-1 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" placeholder="Tu Nombre" required /></div><div><label className="text-sm font-semibold text-gray-600">Email</label><input type="email" className="w-full p-3 mt-1 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" placeholder="tu@email.com" required /></div><div><label className="text-sm font-semibold text-gray-600">Contraseña</label><input type="password" className="w-full p-3 mt-1 border rounded-lg focus:ring-2 focus:ring-orange-400 focus:outline-none" placeholder="Crea una contraseña segura" required /></div><button type="submit" className="w-full bg-orange-500 text-white font-bold py-3 rounded-lg hover:bg-orange-600 transition-colors text-lg">Registrarse</button></form><p className="text-center text-sm text-gray-500 mt-8">¿Ya tienes una cuenta? <button onClick={() => onNavigate('login')} className="font-semibold text-orange-500 hover:underline">Inicia sesión</button></p><p className="text-center text-sm text-gray-500 mt-2"><button onClick={() => onNavigate('landing')} className="hover:underline">Volver al inicio</button></p></div></div>;};
        
        // --- COMPONENTE PRINCIPAL DE LA APP ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [currentPage, setCurrentPage] = useState('landing');
            const handleLogin = (userData) => { setUser(userData); setCurrentPage('dashboard'); };
            const handleLogout = () => { setUser(null); setCurrentPage('landing'); };
            const handleRegister = (userData) => { setUser(userData); setCurrentPage('dashboard'); };
            const renderPage = () => {
                switch (currentPage) {
                    case 'login': return <LoginPage onLogin={handleLogin} onNavigate={setCurrentPage} />;
                    case 'register': return <RegisterPage onRegister={handleRegister} onNavigate={setCurrentPage} />;
                    case 'dashboard': return user ? <DashboardPage user={user} onLogout={handleLogout} /> : <LoginPage onLogin={handleLogin} onNavigate={setCurrentPage} />;
                    default: return <LandingPage onNavigate={setCurrentPage} />;
                }
            };
            return <div>{renderPage()}</div>;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
